{% extends 'base.html' %}
{% load static %}

{% block title %}Announcements - SudaStock{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/announcements.css' %}">
{% endblock %}

{% block content %}
<div class="announcements-page">
    <div class="hero-section">
        <div class="hero-content">
            <h1>Market Announcements</h1>
            <p>Stay updated with the latest news and market trends</p>
        </div>
    </div>

    <div class="container">
        <div class="announcements-filters">
            <div class="filter-group">
                <label for="categoryFilter">Category:</label>
                <select id="categoryFilter" class="form-select">
                    <option value="all">All Categories</option>
                    <option value="market">Market Updates</option>
                    <option value="product">Product News</option>
                    <option value="event">Events</option>
                    <option value="general">General</option>
                </select>
            </div>
            <div class="search-group">
                <input type="text" id="announcementSearch" class="form-control" placeholder="Search announcements...">
                <button id="searchButton" class="search-btn">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <div class="announcements-grid">
            {% for announcement in announcements %}
            <div class="announcement-card" data-category="{{ announcement.category|default:'general' }}">
                <div class="announcement-header">
                    <span class="announcement-date">{{ announcement.created_at|date:"M d, Y" }}</span>
                    <span class="announcement-category badge {% if announcement.category == 'market' %}badge-market{% elif announcement.category == 'product' %}badge-product{% elif announcement.category == 'event' %}badge-event{% else %}badge-general{% endif %}">
                        {{ announcement.category|default:"General"|title }}
                    </span>
                </div>
                <h3 class="announcement-title">{{ announcement.title }}</h3>
                <div class="announcement-content">
                    <p>{{ announcement.content|truncatewords:30 }}</p>
                </div>
                <div class="announcement-footer">
                    <button class="read-more-btn" data-id="{{ announcement.id }}">Read More</button>
                </div>
            </div>
            {% empty %}
            <div class="no-announcements">
                <p>No announcements available at this time.</p>
            </div>
            {% endfor %}
        </div>

        <div class="pagination-container">
            <nav aria-label="Announcements pagination">
                <ul class="pagination">
                    <li class="page-item disabled">
                        <a class="page-link" href="#" tabindex="-1" aria-disabled="true">Previous</a>
                    </li>
                    <li class="page-item active"><a class="page-link" href="#">1</a></li>
                    <li class="page-item"><a class="page-link" href="#">2</a></li>
                    <li class="page-item"><a class="page-link" href="#">3</a></li>
                    <li class="page-item">
                        <a class="page-link" href="#">Next</a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- Announcement Modal -->
    <div class="announcement-modal" id="announcementModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle"></h2>
                <button class="close-modal" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-meta">
                    <span id="modalDate"></span>
                    <span id="modalCategory" class="badge"></span>
                </div>
                <div id="modalContent"></div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Filter functionality
        const categoryFilter = document.getElementById('categoryFilter');
        const searchInput = document.getElementById('announcementSearch');
        const searchButton = document.getElementById('searchButton');
        const announcementCards = document.querySelectorAll('.announcement-card');
        const modal = document.getElementById('announcementModal');
        const closeModal = document.getElementById('closeModal');
        const modalTitle = document.getElementById('modalTitle');
        const modalDate = document.getElementById('modalDate');
        const modalCategory = document.getElementById('modalCategory');
        const modalContent = document.getElementById('modalContent');
        
        // Announcement data
        const announcements = [
            {% for announcement in announcements %}
            {
                id: {{ announcement.id }},
                title: "{{ announcement.title }}",
                content: "{{ announcement.content|escapejs }}",
                date: "{{ announcement.created_at|date:'M d, Y' }}",
                category: "{{ announcement.category|default:'general' }}"
            },
            {% endfor %}
        ];
        
        // Filter by category
        categoryFilter.addEventListener('change', function() {
            filterAnnouncements();
        });
        
        // Search functionality
        searchButton.addEventListener('click', function() {
            filterAnnouncements();
        });
        
        searchInput.addEventListener('keyup', function(e) {
            if (e.key === 'Enter') {
                filterAnnouncements();
            }
        });
        
        function filterAnnouncements() {
            const category = categoryFilter.value;
            const searchTerm = searchInput.value.toLowerCase();
            
            announcementCards.forEach(card => {
                const cardCategory = card.getAttribute('data-category');
                const cardTitle = card.querySelector('.announcement-title').textContent.toLowerCase();
                const cardContent = card.querySelector('.announcement-content').textContent.toLowerCase();
                
                const categoryMatch = category === 'all' || cardCategory === category;
                const searchMatch = searchTerm === '' || 
                                   cardTitle.includes(searchTerm) || 
                                   cardContent.includes(searchTerm);
                
                if (categoryMatch && searchMatch) {
                    card.style.display = '';
                } else {
                    card.style.display = 'none';
                }
            });
        }
        
        // Modal functionality
        document.querySelectorAll('.read-more-btn').forEach(button => {
            button.addEventListener('click', function() {
                const id = parseInt(this.getAttribute('data-id'));
                const announcement = announcements.find(a => a.id === id);
                
                if (announcement) {
                    modalTitle.textContent = announcement.title;
                    modalDate.textContent = announcement.date;
                    modalCategory.textContent = announcement.category.charAt(0).toUpperCase() + announcement.category.slice(1);
                    modalCategory.className = `badge badge-${announcement.category}`;
                    modalContent.innerHTML = announcement.content;
                    
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';
                }
            });
        });
        
        closeModal.addEventListener('click', function() {
            modal.style.display = 'none';
            document.body.style.overflow = '';
        });
        
        window.addEventListener('click', function(e) {
            if (e.target === modal) {
                modal.style.display = 'none';
                document.body.style.overflow = '';
            }
        });
    });
</script>
{% endblock %}
