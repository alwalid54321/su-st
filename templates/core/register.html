{% extends 'base.html' %}
{% load static %}

{% block title %}SudaStock - Register{% endblock %}

{% block styles %}
<link rel="stylesheet" href="{% static 'css/auth.css' %}">
<style>
    /* Animated Background */
    .register-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: #1B1464;
        background-image: linear-gradient(135deg, #1B1464 0%, #1B1464 100%);
        background-size: 400% 400%;
        animation: gradient 15s ease infinite;
    }
    
    @keyframes gradient {
        0% {
            background-position: 0% 50%;
        }
        50% {
            background-position: 100% 50%;
        }
        100% {
            background-position: 0% 50%;
        }
    }
    
    .particles {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        overflow: hidden;
    }
    
    .particle {
        position: absolute;
        width: 10px;
        height: 10px;
        border-radius: 50%;
        background-color: #786D3C;
        opacity: 0.6;
        animation: float 10s ease-out infinite;
    }
    
    @keyframes float {
        0% {
            transform: translateY(0) rotate(0deg);
            opacity: 0.6;
        }
        50% {
            transform: translateY(-20px) rotate(180deg);
            opacity: 0.8;
        }
        100% {
            transform: translateY(0) rotate(360deg);
            opacity: 0.6;
        }
    }
    
    .particle:nth-child(1) {
        top: 20%;
        left: 30%;
        animation-delay: 0s;
    }
    
    .particle:nth-child(2) {
        top: 40%;
        left: 50%;
        animation-delay: 1s;
    }
    
    .particle:nth-child(3) {
        top: 60%;
        left: 70%;
        animation-delay: 2s;
    }
    
    .particle:nth-child(4) {
        top: 80%;
        left: 90%;
        animation-delay: 3s;
    }
    
    .particle:nth-child(5) {
        top: 20%;
        left: 90%;
        animation-delay: 4s;
    }
    
    .particle:nth-child(6) {
        top: 40%;
        left: 70%;
        animation-delay: 5s;
    }
    
    .btn-primary {
        background-color: #1B1464;
        border-color: #1B1464;
    }
    
    .btn-primary:hover, .btn-primary:focus {
        background-color: #786D3C;
        border-color: #786D3C;
    }
    
    .form-control:focus {
        border-color: #786D3C;
        box-shadow: 0 0 0 0.25rem rgba(120, 109, 60, 0.25);
    }
    
    .form-check-input:checked {
        background-color: #786D3C;
        border-color: #786D3C;
    }
    
    .password-strength-meter {
        height: 5px;
        background-color: #eee;
        border-radius: 3px;
        margin-top: 5px;
        overflow: hidden;
    }
    
    .password-strength-meter-bar {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s ease, background-color 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<!-- Animated Background -->
<div class="register-bg">
    <div class="particles">
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
        <div class="particle"></div>
    </div>
</div>

<div class="container h-100">
    <div class="row justify-content-center align-items-center h-100">
        <div class="col-md-6 col-lg-5">
            <div class="auth-form-container">
                <div class="auth-form-content">
                    <div class="auth-header text-center">
                        <div class="auth-logo mb-3">
                            <span style="color: #1B1464; font-size: 2rem; font-weight: 700;">Suda</span><span style="color: #786D3C; font-size: 2rem; font-weight: 700;">Stock</span>
                        </div>
                        <p class="auth-subtitle">Create a new account</p>
                    </div>
                    
                    {% if messages %}
                    <div id="messages-container">
                        {% for message in messages %}
                        <div class="alert alert-{% if message.tags == 'error' %}danger{% else %}{{ message.tags }}{% endif %} alert-dismissible fade show">
                            <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' or message.tags == 'danger' %}fa-exclamation-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %} me-2"></i>
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                    
                    <div class="alert alert-danger" id="registerError" style="display: none;">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <span id="registerErrorMessage"></span>
                    </div>
                    
                    <form method="post" action="{% url 'register' %}" class="needs-validation" novalidate id="registerForm">
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="first_name" name="first_name" placeholder="First Name" required>
                                    <label for="first_name"><i class="fas fa-user me-2"></i>First Name</label>
                                    <div class="invalid-feedback">
                                        Please enter your first name.
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="last_name" name="last_name" placeholder="Last Name" required>
                                    <label for="last_name"><i class="fas fa-user me-2"></i>Last Name</label>
                                    <div class="invalid-feedback">
                                        Please enter your last name.
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="text" class="form-control" id="username" name="username" placeholder="Username" required>
                            <label for="username"><i class="fas fa-user-circle me-2"></i>Username</label>
                            <div class="invalid-feedback">
                                Please choose a username.
                            </div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="email" class="form-control" id="email" name="email" placeholder="Email" required>
                            <label for="email"><i class="fas fa-envelope me-2"></i>Email</label>
                            <div class="invalid-feedback">
                                Please enter a valid email address.
                            </div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="password" name="password" placeholder="Password" required>
                            <label for="password"><i class="fas fa-lock me-2"></i>Password</label>
                            <div class="invalid-feedback">
                                Please enter a password.
                            </div>
                            <div class="password-strength-meter mt-2">
                                <div class="password-strength-meter-bar" id="passwordStrengthBar"></div>
                            </div>
                            <div class="password-strength-text" id="passwordStrengthText"></div>
                        </div>
                        
                        <div class="form-floating mb-3">
                            <input type="password" class="form-control" id="confirm_password" name="confirm_password" placeholder="Confirm Password" required>
                            <label for="confirm_password"><i class="fas fa-lock me-2"></i>Confirm Password</label>
                            <div class="invalid-feedback" id="confirmPasswordFeedback">
                                Please confirm your password.
                            </div>
                        </div>
                        
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="terms" name="terms" required>
                            <label class="form-check-label" for="terms">
                                I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms of Service</a> and <a href="#" data-bs-toggle="modal" data-bs-target="#privacyModal">Privacy Policy</a>
                            </label>
                            <div class="invalid-feedback">
                                You must agree to the terms and conditions.
                            </div>
                        </div>
                        
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="registerButton">
                                <i class="fas fa-user-plus me-2"></i>Create Account
                            </button>
                        </div>
                    </form>
                    
                    <!-- Social Registration Section -->
                    <div class="social-login-section mt-4 text-center">
                        <div class="separator">
                            <span class="separator-text">or register with</span>
                        </div>
                        
                        <div class="social-buttons d-flex justify-content-center">
                            <a href="{% url 'social:begin' 'google-oauth2' %}" class="social-btn google" title="Register with Google">
                                <i class="fab fa-google"></i>
                            </a>
                            <a href="{% url 'social:begin' 'facebook' %}" class="social-btn facebook" title="Register with Facebook">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="{% url 'social:begin' 'apple-id' %}" class="social-btn apple" title="Register with Apple">
                                <i class="fab fa-apple"></i>
                            </a>
                            <a href="{% url 'social:begin' 'microsoft-graph' %}" class="social-btn microsoft" title="Register with Microsoft">
                                <i class="fab fa-microsoft"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="auth-footer text-center mt-4">
                        <p>Already have an account? <a href="{% url 'login' %}" style="color: #786D3C; font-weight: 500;">Sign in here</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms of Service Modal -->
<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Terms of Service</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptance of Terms</h6>
                <p>By accessing and using SudaStock, you agree to be bound by these Terms of Service.</p>
                
                <h6>2. User Accounts</h6>
                <p>You are responsible for maintaining the confidentiality of your account information and for all activities that occur under your account.</p>
                
                <h6>3. User Conduct</h6>
                <p>You agree not to use the service for any illegal purposes or to conduct any illegal activity.</p>
                
                <h6>4. Intellectual Property</h6>
                <p>All content included on the website, such as text, graphics, logos, and software, is the property of SudaStock.</p>
                
                <h6>5. Limitation of Liability</h6>
                <p>SudaStock shall not be liable for any indirect, incidental, special, consequential or punitive damages.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1" aria-labelledby="privacyModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="privacyModalLabel">Privacy Policy</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h6>1. Information We Collect</h6>
                <p>We collect information you provide directly to us when you create an account, such as your name, email address, and password.</p>
                
                <h6>2. How We Use Information</h6>
                <p>We use the information we collect to provide, maintain, and improve our services, and to communicate with you.</p>
                
                <h6>3. Information Sharing</h6>
                <p>We do not share your personal information with third parties except as described in this privacy policy.</p>
                
                <h6>4. Data Security</h6>
                <p>We take reasonable measures to help protect your personal information from loss, theft, misuse, and unauthorized access.</p>
                
                <h6>5. Your Choices</h6>
                <p>You can update your account information and preferences at any time by logging into your account.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Form validation
        const form = document.getElementById('registerForm');
        const password = document.getElementById('password');
        const confirmPassword = document.getElementById('confirm_password');
        const confirmPasswordFeedback = document.getElementById('confirmPasswordFeedback');
        const registerError = document.getElementById('registerError');
        const registerErrorMessage = document.getElementById('registerErrorMessage');
        const passwordStrengthBar = document.getElementById('passwordStrengthBar');
        const passwordStrengthText = document.getElementById('passwordStrengthText');
        
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            
            // Check if passwords match
            if (password.value !== confirmPassword.value) {
                event.preventDefault();
                confirmPassword.setCustomValidity('Passwords do not match');
                confirmPasswordFeedback.textContent = 'Passwords do not match';
            } else {
                confirmPassword.setCustomValidity('');
            }
            
            form.classList.add('was-validated');
        });
        
        // Password strength meter
        password.addEventListener('input', function() {
            const value = password.value;
            let strength = 0;
            
            // Check length
            if (value.length >= 8) {
                strength += 1;
            }
            
            // Check lowercase and uppercase
            if (value.match(/[a-z]/) && value.match(/[A-Z]/)) {
                strength += 1;
            }
            
            // Check numbers
            if (value.match(/\d/)) {
                strength += 1;
            }
            
            // Check special characters
            if (value.match(/[^a-zA-Z0-9]/)) {
                strength += 1;
            }
            
            // Update strength meter
            switch (strength) {
                case 0:
                    passwordStrengthBar.style.width = '0%';
                    passwordStrengthBar.style.backgroundColor = '#dc3545';
                    passwordStrengthText.textContent = '';
                    break;
                case 1:
                    passwordStrengthBar.style.width = '25%';
                    passwordStrengthBar.style.backgroundColor = '#dc3545';
                    passwordStrengthText.textContent = 'Weak';
                    passwordStrengthText.style.color = '#dc3545';
                    break;
                case 2:
                    passwordStrengthBar.style.width = '50%';
                    passwordStrengthBar.style.backgroundColor = '#ffc107';
                    passwordStrengthText.textContent = 'Medium';
                    passwordStrengthText.style.color = '#ffc107';
                    break;
                case 3:
                    passwordStrengthBar.style.width = '75%';
                    passwordStrengthBar.style.backgroundColor = '#28a745';
                    passwordStrengthText.textContent = 'Strong';
                    passwordStrengthText.style.color = '#28a745';
                    break;
                case 4:
                    passwordStrengthBar.style.width = '100%';
                    passwordStrengthBar.style.backgroundColor = '#28a745';
                    passwordStrengthText.textContent = 'Very Strong';
                    passwordStrengthText.style.color = '#28a745';
                    break;
            }
        });
        
        // Check password match
        confirmPassword.addEventListener('input', function() {
            if (password.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity('Passwords do not match');
                confirmPasswordFeedback.textContent = 'Passwords do not match';
            } else {
                confirmPassword.setCustomValidity('');
                confirmPasswordFeedback.textContent = 'Please confirm your password.';
            }
        });
        
        // Show error message function
        function showError(message) {
            registerErrorMessage.textContent = message;
            registerError.style.display = 'block';
            
            setTimeout(function() {
                registerError.style.display = 'none';
            }, 5000);
        }
        
        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert-dismissible');
            alerts.forEach(function(alert) {
                const bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);
    });
</script>
{% endblock %}
