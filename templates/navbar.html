{% load static %}
<!-- Modern Navbar -->
<nav class="navbar">
    <div class="navbar-container">
        <a href="/" class="logo-container">
            <img src="{% static 'images/logo-icon.png' %}" alt="SudaStock Logo" class="logo">
        </a>
        
        <button class="mobile-menu-toggle" id="mobileMenuToggle">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="nav-links" id="navLinks">
            <a href="/" class="nav-link {% if request.path == '/' %}active{% endif %}">HOME</a>
            <a href="/about/" class="nav-link {% if request.path == '/about/' %}active{% endif %}">ABOUT US</a>
            
            <div class="mega-dropdown">
                <a href="/products/" class="nav-link {% if '/products/' in request.path %}active{% endif %}">
                    <span>PRODUCTS</span>
                    <i class="fas fa-angle-down"></i>
                </a>
                <div class="mega-content">
                    <div class="mega-container">
                        <div class="mega-row">
                            <div class="mega-col mega-intro">
                                <h4>Our Products</h4>
                                <p>Discover Sudan's premium agricultural exports</p>
                                <a href="/products/" class="mega-btn">View All Products</a>
                            </div>
                            <div class="mega-col">
                                <div class="mega-category">
                                    <h5>Seeds & Grains</h5>
                                    <ul class="mega-list">
                                        <li>
                                            <a href="/products/#sesame-gad">
                                                <i class="fas fa-seedling"></i>
                                                <span>Sesame</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="/products/#watermelon-seeds">
                                                <i class="fas fa-apple-alt"></i>
                                                <span>Watermelon Seeds</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="/products/#pigeon-seeds">
                                                <i class="fas fa-feather"></i>
                                                <span>Pigeon Seeds</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mega-col">
                                <div class="mega-category">
                                    <h5>Legumes & Pulses</h5>
                                    <ul class="mega-list">
                                        <li>
                                            <a href="/products/#peanuts">
                                                <i class="fas fa-leaf"></i>
                                                <span>Peanuts</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="/products/#chick-peas">
                                                <i class="fas fa-egg"></i>
                                                <span>Chick Peas</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="mega-col">
                                <div class="mega-category">
                                    <h5>Fibers & Gums</h5>
                                    <ul class="mega-list">
                                        <li>
                                            <a href="/products/#cotton">
                                                <i class="fas fa-tshirt"></i>
                                                <span>Cotton</span>
                                            </a>
                                        </li>
                                        <li>
                                            <a href="/products/#acacia-sen">
                                                <i class="fas fa-tree"></i>
                                                <span>Gums</span>
                                            </a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {% if user.is_authenticated %}
            <a href="/data/" class="nav-link {% if request.path == '/data/' %}active{% endif %}">DATA</a>
            {% else %}
            <a href="/login/" class="nav-link locked {% if request.path == '/data/' %}active{% endif %}">
                DATA
                <span class="locked-tooltip">Login required</span>
            </a>
            {% endif %}
            
            <a href="/contact/" class="nav-link {% if request.path == '/contact/' %}active{% endif %}">CONTACT US</a>
            
            <div class="auth-buttons">
                {% if user.is_authenticated %}
                <div class="user-dropdown">
                    <a href="/dashboard/" class="user-menu">
                        <div class="user-avatar">
                            <i class="fas fa-user"></i>
                        </div>
                        <span class="user-name">{{ user.username }}</span>
                        <i class="fas fa-chevron-down"></i>
                    </a>
                    <ul class="user-dropdown-menu">
                        <li><a href="/dashboard/"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li><a href="/profile/"><i class="fas fa-user-circle"></i> Profile</a></li>
                        {% if user.is_staff %}
                        <li><a href="{% url 'admin_dashboard' %}"><i class="fas fa-cogs"></i> Admin Panel</a></li>
                        {% endif %}
                        <li>
                            <form id="logout-form" action="{% url 'logout' %}" method="post" style="display: inline;">
                                {% csrf_token %}
                                <a href="javascript:void(0);" onclick="document.getElementById('logout-form').submit();">
                                    <i class="fas fa-sign-out-alt"></i> Logout
                                </a>
                            </form>
                        </li>
                    </ul>
                </div>
                {% else %}
                <a href="/login/" class="auth-btn login-btn">LOGIN</a>
                <a href="/register/" class="auth-btn register-btn">REGISTER</a>
                {% endif %}
            </div>
            
            <!-- Dark Mode Toggle -->
            <!-- <div class="dark-mode-container">
                <div class="dark-mode-toggle" id="darkModeToggle">
                    <i class="fas fa-sun toggle-icon"></i>
                    <i class="fas fa-moon toggle-icon"></i>
                    <div class="toggle-handle"></div>
                </div>
            </div> -->
        </div>
    </div>
</nav>

<script>
    // Mobile menu toggle with improved functionality
    document.addEventListener('DOMContentLoaded', function() {
        const mobileMenuToggle = document.getElementById('mobileMenuToggle');
        const navLinks = document.getElementById('navLinks');
        
        if (mobileMenuToggle && navLinks) {
            mobileMenuToggle.addEventListener('click', function(e) {
                e.preventDefault();
                e.stopPropagation();
                navLinks.classList.toggle('active');
                mobileMenuToggle.classList.toggle('active');
            });
        }
    });
    
    // Handle mobile dropdown menus
    document.addEventListener('DOMContentLoaded', function() {
        if (window.innerWidth <= 991.98) {
            // Handle products dropdown
            const productDropdowns = document.querySelectorAll('.mega-dropdown');
            
            productDropdowns.forEach(dropdown => {
                const link = dropdown.querySelector('.nav-link');
                
                if (link) {
                    link.addEventListener('click', function(e) {
                        if (window.innerWidth <= 991.98) {
                            e.preventDefault();
                            dropdown.classList.toggle('active');
                        }
                    });
                }
            });
            
            // Handle user dropdown
            const userDropdowns = document.querySelectorAll('.user-dropdown');
            
            userDropdowns.forEach(dropdown => {
                const link = dropdown.querySelector('.user-menu');
                
                if (link) {
                    link.addEventListener('click', function(e) {
                        if (window.innerWidth <= 991.98) {
                            e.preventDefault();
                            dropdown.classList.toggle('active');
                        }
                    });
                }
            });
        }
        
        // Update on window resize
        window.addEventListener('resize', function() {
            const isMobile = window.innerWidth <= 991.98;
            
            document.querySelectorAll('.mega-dropdown .nav-link, .user-dropdown .user-menu').forEach(link => {
                if (isMobile) {
                    link.addEventListener('click', handleMobileClick);
                } else {
                    link.removeEventListener('click', handleMobileClick);
                }
            });
        });
        
        function handleMobileClick(e) {
            if (window.innerWidth <= 991.98) {
                e.preventDefault();
                this.closest('.mega-dropdown, .user-dropdown').classList.toggle('active');
            }
        }
    });
</script>
